<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Dialogue Practice</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="quiz.css">
<script src="shared.js"></script>
<style>
  .dlg { max-width: 760px; margin: 24px auto; padding: 10px; }
  .line { padding: 10px; border-bottom: 1px solid #eee; }
  .role { font-weight:700; margin-right:8px; }
  .you { background: #fffbea; }
  .tools button { margin-right:6px; margin-top:6px; }
  .asr { font-size:.95rem; color:#555; margin-top:4px; }
</style>
</head>
<body>
<div class="dlg">
  <h1>🎙️ Dialogue Practice – Buying Art Supplies</h1>
  <p>提示：<u>點英文台詞</u>可朗讀；按「🎤 我來說」可試著跟讀（支援的瀏覽器）。</p>

  <!-- 一句一塊；data-say 讓點擊即朗讀 -->
  <div class="line">
    <span class="role">A:</span>
    <span data-say="Hi, can I help you find anything?">Hi, can I help you find anything?</span>
    <div class="tools">
      <button onclick="speak('Hi, can I help you find anything?')">▶️ 播放</button>
    </div>
  </div>

  <div class="line you">
    <span class="role">B (You):</span>
    <span data-say="Yes, I’m looking for a set of brushes for watercolor.">
      Yes, I’m looking for a set of brushes for watercolor.
    </span>
    <div class="tools">
      <button onclick="speak('Yes, I’m looking for a set of brushes for watercolor.')">▶️ 播放</button>
      <button onclick="recordAndCompare(this,'Yes, I’m looking for a set of brushes for watercolor.')">🎤 我來說</button>
      <div class="asr"></div>
    </div>
  </div>

  <div class="line">
    <span class="role">A:</span>
    <span data-say="These are soft brushes. They work well for light strokes.">
      These are soft brushes. They work well for light strokes.
    </span>
    <div class="tools">
      <button onclick="speak('These are soft brushes. They work well for light strokes.')">▶️ 播放</button>
    </div>
  </div>

  <div class="line you">
    <span class="role">B (You):</span>
    <span data-say="Great. I’ll take this set. Thank you!">
      Great. I’ll take this set. Thank you!
    </span>
    <div class="tools">
      <button onclick="speak('Great. I’ll take this set. Thank you!')">▶️ 播放</button>
      <button onclick="recordAndCompare(this,'Great. I’ll take this set. Thank you!')">🎤 我來說</button>
      <div class="asr"></div>
    </div>
  </div>
</div>

<script>
/* 簡易語音辨識（可用則開啟） */
const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
function recordAndCompare(btn, targetText){
  const box = btn.closest('.tools').querySelector('.asr');
  if(!SR){
    box.textContent = '此瀏覽器不支援語音辨識（仍可點擊英文朗讀）';
    return;
  }
  const rec = new SR();
  rec.lang = 'en-US';
  rec.interimResults = false;
  box.textContent = '🎧 正在聽…請說出英文句子';
  rec.onresult = (e)=>{
    const said = e.results[0][0].transcript;
    const sim = similarity(normalize(said), normalize(targetText));
    box.textContent = `你說：${said}（相似度 ${(sim*100).toFixed(0)}%）`;
  };
  rec.onerror = ()=>{ box.textContent = '無法辨識，請再試一次或改用播放練習。'; };
  rec.start();
}
function normalize(s){ return s.toLowerCase().replace(/[^a-z0-9\s']/g,'').trim(); }
function similarity(a,b){
  // 極簡 Jaccard for words
  const A = new Set(a.split(/\s+/)), B = new Set(b.split(/\s+/));
  const inter = [...A].filter(x=>B.has(x)).length;
  const union = new Set([...A, ...B]).size;
  return union? inter/union : 0;
}
</script>
</body>
</html>
