<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Dialogue Practice</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="quiz.css">
<script src="shared.js"></script>
<style>
  .dlg { max-width: 760px; margin: 24px auto; padding: 10px; }
  .line { padding: 10px; border-bottom: 1px solid #eee; }
  .role { font-weight:700; margin-right:8px; }
  .you { background: #fffbea; }
  .tools button { margin-right:6px; margin-top:6px; }
  .asr { font-size:.95rem; color:#555; margin-top:4px; }
</style>
</head>
<body>
<div class="dlg">
  <h1>ğŸ™ï¸ Dialogue Practice â€“ Buying Art Supplies</h1>
  <p>æç¤ºï¼š<u>é»è‹±æ–‡å°è©</u>å¯æœ—è®€ï¼›æŒ‰ã€ŒğŸ¤ æˆ‘ä¾†èªªã€å¯è©¦è‘—è·Ÿè®€ï¼ˆæ”¯æ´çš„ç€è¦½å™¨ï¼‰ã€‚</p>

  <!-- ä¸€å¥ä¸€å¡Šï¼›data-say è®“é»æ“Šå³æœ—è®€ -->
  <div class="line">
    <span class="role">A:</span>
    <span data-say="Hi, can I help you find anything?">Hi, can I help you find anything?</span>
    <div class="tools">
      <button onclick="speak('Hi, can I help you find anything?')">â–¶ï¸ æ’­æ”¾</button>
    </div>
  </div>

  <div class="line you">
    <span class="role">B (You):</span>
    <span data-say="Yes, Iâ€™m looking for a set of brushes for watercolor.">
      Yes, Iâ€™m looking for a set of brushes for watercolor.
    </span>
    <div class="tools">
      <button onclick="speak('Yes, Iâ€™m looking for a set of brushes for watercolor.')">â–¶ï¸ æ’­æ”¾</button>
      <button onclick="recordAndCompare(this,'Yes, Iâ€™m looking for a set of brushes for watercolor.')">ğŸ¤ æˆ‘ä¾†èªª</button>
      <div class="asr"></div>
    </div>
  </div>

  <div class="line">
    <span class="role">A:</span>
    <span data-say="These are soft brushes. They work well for light strokes.">
      These are soft brushes. They work well for light strokes.
    </span>
    <div class="tools">
      <button onclick="speak('These are soft brushes. They work well for light strokes.')">â–¶ï¸ æ’­æ”¾</button>
    </div>
  </div>

  <div class="line you">
    <span class="role">B (You):</span>
    <span data-say="Great. Iâ€™ll take this set. Thank you!">
      Great. Iâ€™ll take this set. Thank you!
    </span>
    <div class="tools">
      <button onclick="speak('Great. Iâ€™ll take this set. Thank you!')">â–¶ï¸ æ’­æ”¾</button>
      <button onclick="recordAndCompare(this,'Great. Iâ€™ll take this set. Thank you!')">ğŸ¤ æˆ‘ä¾†èªª</button>
      <div class="asr"></div>
    </div>
  </div>
</div>

<script>
/* ç°¡æ˜“èªéŸ³è¾¨è­˜ï¼ˆå¯ç”¨å‰‡é–‹å•Ÿï¼‰ */
const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
function recordAndCompare(btn, targetText){
  const box = btn.closest('.tools').querySelector('.asr');
  if(!SR){
    box.textContent = 'æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¾¨è­˜ï¼ˆä»å¯é»æ“Šè‹±æ–‡æœ—è®€ï¼‰';
    return;
  }
  const rec = new SR();
  rec.lang = 'en-US';
  rec.interimResults = false;
  box.textContent = 'ğŸ§ æ­£åœ¨è½â€¦è«‹èªªå‡ºè‹±æ–‡å¥å­';
  rec.onresult = (e)=>{
    const said = e.results[0][0].transcript;
    const sim = similarity(normalize(said), normalize(targetText));
    box.textContent = `ä½ èªªï¼š${said}ï¼ˆç›¸ä¼¼åº¦ ${(sim*100).toFixed(0)}%ï¼‰`;
  };
  rec.onerror = ()=>{ box.textContent = 'ç„¡æ³•è¾¨è­˜ï¼Œè«‹å†è©¦ä¸€æ¬¡æˆ–æ”¹ç”¨æ’­æ”¾ç·´ç¿’ã€‚'; };
  rec.start();
}
function normalize(s){ return s.toLowerCase().replace(/[^a-z0-9\s']/g,'').trim(); }
function similarity(a,b){
  // æ¥µç°¡ Jaccard for words
  const A = new Set(a.split(/\s+/)), B = new Set(b.split(/\s+/));
  const inter = [...A].filter(x=>B.has(x)).length;
  const union = new Set([...A, ...B]).size;
  return union? inter/union : 0;
}
</script>
</body>
</html>
